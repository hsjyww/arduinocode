#include <Arduino.h>
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <RTClib.h>

// LCD 주소가 0x27인 경우가 가장 흔함. 0x3F 모듈도 있으니 필요 시 바꾸세요.
LiquidCrystal_I2C lcd(0x27, 16, 2);
RTC_DS3231 rtc;

void printTwoDigit(int v) {
  if (v < 10) lcd.print('0');
  lcd.print(v);
}

void setup() {
  // I2C 시작
  Wire.begin();

  // LCD 초기화
  lcd.init();
  lcd.backlight();
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("RTC Clock Start");
  delay(800);

  // RTC 시작
  if (!rtc.begin()) {
    lcd.clear();
    lcd.print("RTC not found!");
    while (1) { delay(100); }
  }

  // RTC가 처음이거나 전원유실 후 초기화 필요 시, 컴파일 시각으로 자동 맞춤
  if (rtc.lostPower()) {
    rtc.adjust(DateTime(2025, 9, 15, 15, 21, 00));
  }

  lcd.clear();
}

void loop() {
  DateTime now = rtc.now();

  // 1행: 날짜 YYYY-MM-DD
  lcd.setCursor(0, 0);
  lcd.print(now.year());
  lcd.print('-');
  printTwoDigit(now.month());
  lcd.print('-');
  printTwoDigit(now.day());

  // 2행: 요일 및 시각 HH:MM:SS
  static const char* wdays[] = {"Sun","Mon","Tue","Wed","Thu","Fri","Sat"};
  lcd.setCursor(0, 1);
  lcd.print(wdays[now.dayOfTheWeek()]);
  lcd.print(' ');
  printTwoDigit(now.hour());
  lcd.print(':');
  printTwoDigit(now.minute());
  lcd.print(':');
  printTwoDigit(now.second());

  delay(200);
}
